---
phase: 01-foundation-and-tooling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - global.json
  - .config/dotnet-tools.json
  - .gitignore
  - package.json
  - src/App.fsproj
  - src/Main.fs
  - src/App.fs
  - vite.config.js
  - index.html
autonomous: true

must_haves:
  truths:
    - "Project has pinned .NET SDK version in global.json"
    - "Project has package.json with exact npm package versions"
    - "F# project file exists with Fable/Elmish packages"
    - "Vite can find F# entry point via index.html"
  artifacts:
    - path: "global.json"
      provides: ".NET SDK version pinning"
      contains: "\"version\": \"10.0.100\""
    - path: ".config/dotnet-tools.json"
      provides: ".NET local tools manifest"
      contains: "\"version\": 1"
    - path: "package.json"
      provides: "npm dependencies with exact versions"
      contains: "react@18.3.1"
    - path: "src/App.fsproj"
      provides: "F# project with Fable packages"
      contains: "Fable.Elmish"
    - path: "vite.config.js"
      provides: "Vite + Fable plugin configuration"
      contains: "vite-plugin-fable"
    - path: "index.html"
      provides: "HTML entry point importing F# module"
      contains: "import \"/src/Main.fs\""
  key_links:
    - from: "index.html"
      to: "src/Main.fs"
      via: "script type=module import statement"
      pattern: "import.*\"/src/Main\\.fs\""
    - from: "vite.config.js"
      to: "vite-plugin-fable"
      via: "plugins array"
      pattern: "fable\\(\\{"
---

<objective>
Create complete F# + Elmish + Vite project structure with proper version pinning and HMR configuration.

Purpose: Establishes reproducible development environment with all configuration files needed for Fable 4 + Vite workflow
Output: Project structure ready for npm install and dotnet restore
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation-and-tooling/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Create version pinning and package manifest files</name>
  <files>global.json, .config/dotnet-tools.json, .gitignore, package.json</files>
  <action>
Create global.json pinning .NET SDK to 10.0.100 with rollForward: "latestFeature":
```json
{
  "sdk": {
    "version": "10.0.100",
    "rollForward": "latestFeature"
  }
}
```

Create .config/dotnet-tools.json as empty tools manifest (standard .NET convention for local tools):
```json
{
  "version": 1,
  "isRoot": true,
  "tools": {}
}
```

Note: vite-plugin-fable manages Fable internally, so Fable CLI is NOT needed as a dotnet tool. This manifest follows .NET best practices for version pinning and allows future tool additions if needed.

Create .gitignore for F# + Node + Vite project:
```
# .NET
bin/
obj/
*.fsproj.user

# Node
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Vite
dist/
.vite/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db
```

Create package.json with exact versions per RESEARCH.md Pattern 1:
```json
{
  "name": "caltwo",
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "18.3.1",
    "react-dom": "18.3.1"
  },
  "devDependencies": {
    "vite": "^7.0.0",
    "vite-plugin-fable": "^0.1.1",
    "@vitejs/plugin-react": "^4.3.4"
  }
}
```

CRITICAL: Use React 18.3.1 (NOT React 19) per RESEARCH.md - Feliz 2.x has key warnings with React 19.
  </action>
  <verify>
Files exist:
- ls global.json .config/dotnet-tools.json .gitignore package.json
- cat global.json | grep "10.0.100"
- cat .config/dotnet-tools.json | grep '"version": 1'
- cat package.json | grep "18.3.1"
  </verify>
  <done>
global.json exists with .NET 10.0.100, .config/dotnet-tools.json exists as empty tools manifest, .gitignore covers .NET + Node + Vite, package.json has React 18.3.1 and Vite 7
  </done>
</task>

<task type="auto">
  <name>Create F# project structure with Elmish packages</name>
  <files>src/App.fsproj, src/Main.fs, src/App.fs</files>
  <action>
Create src/ directory if not exists: mkdir -p src

Create src/App.fsproj with explicit PackageReference versions per RESEARCH.md:
```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
  </PropertyGroup>
  <ItemGroup>
    <Compile Include="App.fs" />
    <Compile Include="Main.fs" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Fable.Core" Version="4.3.0" />
    <PackageReference Include="Feliz" Version="2.9.0" />
    <PackageReference Include="Fable.Elmish" Version="5.0.2" />
    <PackageReference Include="Fable.Elmish.React" Version="5.0.1" />
    <PackageReference Include="Fable.Elmish.HMR" Version="7.0.0" />
    <PackageReference Include="Fable.Browser.Dom" Version="2.14.0" />
  </ItemGroup>
</Project>
```

Create src/App.fs with minimal MVU structure:
```fsharp
module App

open Feliz
open Elmish

type Model = { Message: string }

type Msg = NoOp

let init () = { Message = "Hello CalTwo" }, Cmd.none

let update msg model =
    match msg with
    | NoOp -> model, Cmd.none

let view model dispatch =
    Html.div [
        prop.style [ style.padding 20; style.fontFamily "sans-serif" ]
        prop.children [
            Html.h1 model.Message
            Html.p "F# + Elmish + Vite + HMR is working!"
        ]
    ]
```

Create src/Main.fs with HMR-enabled program per RESEARCH.md Pattern 2:
```fsharp
module Main

open Elmish
open Elmish.React
open Elmish.HMR  // MUST be last - shadows Program.run

Program.mkProgram App.init App.update App.view
|> Program.withReactSynchronous "elmish-app"
|> Program.run
```

CRITICAL: open Elmish.HMR MUST be LAST per RESEARCH.md Common Pitfalls #3.
File order in .fsproj: App.fs before Main.fs (dependency order).
  </action>
  <verify>
Files exist and have correct structure:
- ls src/App.fsproj src/App.fs src/Main.fs
- grep "Fable.Elmish" src/App.fsproj
- grep "Elmish.HMR" src/Main.fs
- grep "Hello CalTwo" src/App.fs
  </verify>
  <done>
src/App.fsproj exists with 6 Fable packages, App.fs has MVU model/update/view with "Hello CalTwo", Main.fs has Elmish program with HMR enabled
  </done>
</task>

<task type="auto">
  <name>Create Vite configuration and HTML entry point</name>
  <files>vite.config.js, index.html</files>
  <action>
Create vite.config.js per RESEARCH.md Pattern 1:
```javascript
import { defineConfig } from "vite";
import fable from "vite-plugin-fable";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [
    fable({
      jsx: "automatic"
    }),
    react({
      include: /\.(fs|js|jsx|ts|tsx)$/
    })
  ],
  build: {
    sourcemap: true
  }
});
```

Create index.html per RESEARCH.md Pattern 4:
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CalTwo</title>
</head>
<body>
  <div id="elmish-app"></div>
  <script type="module">
    import "/src/Main.fs";
  </script>
</body>
</html>
```

CRITICAL:
- Plugin order: fable() BEFORE react() per RESEARCH.md Anti-Patterns
- Use import statement (NOT src attribute) per RESEARCH.md Pattern 4
- build.sourcemap: true ensures production source maps work
  </action>
  <verify>
Files exist with correct patterns:
- ls vite.config.js index.html
- grep "vite-plugin-fable" vite.config.js
- grep "sourcemap: true" vite.config.js
- grep 'import "/src/Main.fs"' index.html
  </verify>
  <done>
vite.config.js exists with fable + react plugins (correct order) and sourcemap enabled, index.html has script import statement for Main.fs
  </done>
</task>

</tasks>

<verification>
All configuration files exist and follow RESEARCH.md patterns:
- Version pinning: global.json has .NET 10.0.100
- Tools manifest: .config/dotnet-tools.json exists (empty, follows .NET convention)
- Package manifest: package.json has React 18.3.1, Vite 7, vite-plugin-fable
- F# project: App.fsproj has 6 Fable packages with explicit versions
- Source files: App.fs (MVU), Main.fs (Elmish.HMR last)
- Build config: vite.config.js (plugin order correct, sourcemap enabled)
- HTML entry: index.html (import statement, not src attribute)
</verification>

<success_criteria>
1. All 9 files created (global.json, .config/dotnet-tools.json, .gitignore, package.json, App.fsproj, App.fs, Main.fs, vite.config.js, index.html)
2. Version pinning follows RESEARCH.md: .NET 10, React 18.3.1, Fable 4.3.0
3. dotnet-tools.json exists at .config/dotnet-tools.json (standard .NET location)
4. Elmish.HMR opened last in Main.fs (HMR will work)
5. Vite plugin order correct: fable before react (transpilation will work)
6. HTML uses import statement (Vite can recognize .fs extension)
7. build.sourcemap: true in vite.config.js (source maps will work in production)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-tooling/01-01-SUMMARY.md`
</output>
