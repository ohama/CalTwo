---
phase: 01-foundation-and-tooling
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified:
  - package-lock.json
  - node_modules/
  - src/obj/
  - tutorial/phase-01.md
autonomous: true

must_haves:
  truths:
    - "npm packages installed successfully (node_modules/ exists)"
    - ".NET packages restored (src/obj/ exists)"
    - "Dev server starts without errors"
    - "Browser shows 'Hello CalTwo' at localhost"
    - "Korean tutorial explains setup step-by-step"
  artifacts:
    - path: "node_modules/"
      provides: "Installed npm dependencies"
      min_files: 100
    - path: "src/obj/"
      provides: "Restored .NET packages"
      contains: "project.assets.json"
    - path: "tutorial/phase-01.md"
      provides: "Korean tutorial for Phase 1"
      min_lines: 100
  key_links:
    - from: "package.json"
      to: "node_modules/"
      via: "npm install"
      pattern: "vite-plugin-fable"
    - from: "src/App.fsproj"
      to: "src/obj/"
      via: "dotnet restore"
      pattern: "Fable.Elmish"
---

<objective>
Install all project dependencies, verify dev server starts successfully, and create Korean tutorial documenting the complete setup process.

Purpose: Transforms configuration into working development environment and documents setup for beginners
Output: Working dev server showing "Hello CalTwo" + comprehensive Korean tutorial
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation-and-tooling/01-RESEARCH.md
@.planning/phases/01-foundation-and-tooling/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Install npm and .NET packages</name>
  <files>package-lock.json, node_modules/, src/obj/</files>
  <action>
Install npm packages:
```bash
npm install
```

This installs:
- react@18.3.1, react-dom@18.3.1
- vite@^7.0.0, vite-plugin-fable@^0.1.1, @vitejs/plugin-react@^4.3.4

Restore .NET packages:
```bash
dotnet restore src/App.fsproj
```

This restores:
- Fable.Core 4.3.0
- Feliz 2.9.0
- Fable.Elmish 5.0.2
- Fable.Elmish.React 5.0.1
- Fable.Elmish.HMR 7.0.0
- Fable.Browser.Dom 2.14.0

Verify installations:
```bash
ls node_modules/vite-plugin-fable
ls src/obj/project.assets.json
```

If npm install fails with version conflicts, check package.json has exact versions (not ranges). If dotnet restore fails, verify global.json SDK version is installed.
  </action>
  <verify>
Run checks:
- test -d node_modules && echo "npm packages installed"
- test -f node_modules/vite-plugin-fable/package.json && echo "vite-plugin-fable present"
- test -f src/obj/project.assets.json && echo ".NET packages restored"
  </verify>
  <done>
node_modules/ exists with vite-plugin-fable, package-lock.json created, src/obj/project.assets.json exists
  </done>
</task>

<task type="auto">
  <name>Start dev server and verify "Hello CalTwo" renders</name>
  <files>(no file changes, verification only)</files>
  <action>
Start Vite dev server in background:
```bash
npm run dev &
```

Wait 5 seconds for server to start, then check it's running:
```bash
sleep 5
curl -I http://localhost:5173/ | head -1
```

Should return "HTTP/1.1 200 OK".

Fetch HTML and verify it contains our app div:
```bash
curl -s http://localhost:5173/ | grep 'id="elmish-app"'
```

Stop the background server:
```bash
pkill -f "vite"
```

EXPECTED BEHAVIOR:
1. Vite starts without compilation errors
2. Browser HTML contains div#elmish-app
3. No console errors about missing modules
4. Fable transpiles F# files to JS successfully

If dev server fails to start:
- Check for port conflict (kill process on 5173)
- Verify vite-plugin-fable is installed
- Check F# syntax errors in App.fs or Main.fs

If "Hello CalTwo" doesn't appear:
- Check browser console for runtime errors
- Verify Elmish.HMR is opened last in Main.fs
- Check React version is 18.3.1 (not 19)
  </action>
  <verify>
Verification steps:
1. npm run dev starts without errors
2. curl http://localhost:5173/ returns 200
3. HTML contains <div id="elmish-app"></div>
4. No Fable compilation errors in terminal
5. Server stops cleanly with pkill
  </verify>
  <done>
Dev server starts successfully, returns 200 OK, HTML contains elmish-app div, Fable transpiles F# without errors
  </done>
</task>

<task type="auto">
  <name>Create Korean tutorial for Phase 1</name>
  <files>tutorial/phase-01.md</files>
  <action>
Create tutorial/ directory: mkdir -p tutorial

Create tutorial/phase-01.md following TUT-01, TUT-02, TUT-03 requirements:

```markdown
# Phase 1: 기초 환경 구축 (Foundation & Tooling)

## 개요

이 튜토리얼에서는 F# + Elmish + Vite를 사용한 웹 애플리케이션 개발 환경을 처음부터 설정합니다.
완료 후 HMR(Hot Module Replacement)이 작동하는 개발 서버를 실행할 수 있습니다.

**학습 목표:**
- F# 웹 프로젝트의 기본 구조 이해
- Fable(F# → JavaScript 컴파일러) 동작 원리
- Elmish MVU 패턴의 기초
- Vite 개발 서버와 HMR 활용

**사전 요구사항:**
- .NET SDK 10.0 이상 설치
- Node.js 18 이상 설치
- 기본적인 F# 문법 이해 (let, type, match)

## 1단계: 버전 고정 (Version Pinning)

### 왜 버전을 고정하나요?

프로젝트가 언제, 어디서든 동일하게 빌드되려면 도구의 버전을 명시해야 합니다.
팀원이나 CI 환경에서도 같은 결과를 얻을 수 있습니다.

### global.json - .NET SDK 버전 고정

```json
{
  "sdk": {
    "version": "10.0.100",
    "rollForward": "latestFeature"
  }
}
```

- `version`: 사용할 정확한 SDK 버전
- `rollForward`: 패치 버전 업데이트 허용 (10.0.101, 10.0.102는 OK, 10.1.x는 NO)

### package.json - npm 패키지 버전 고정

```json
{
  "dependencies": {
    "react": "18.3.1",
    "react-dom": "18.3.1"
  },
  "devDependencies": {
    "vite": "^7.0.0",
    "vite-plugin-fable": "^0.1.1",
    "@vitejs/plugin-react": "^4.3.4"
  }
}
```

**중요:** React 18.3.1을 사용합니다 (React 19는 Feliz 2.x와 호환 이슈).

## 2단계: F# 프로젝트 구조

### App.fsproj - F# 프로젝트 파일

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
  </PropertyGroup>
  <ItemGroup>
    <Compile Include="App.fs" />
    <Compile Include="Main.fs" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Fable.Core" Version="4.3.0" />
    <PackageReference Include="Feliz" Version="2.9.0" />
    <PackageReference Include="Fable.Elmish" Version="5.0.2" />
    <PackageReference Include="Fable.Elmish.React" Version="5.0.1" />
    <PackageReference Include="Fable.Elmish.HMR" Version="7.0.0" />
    <PackageReference Include="Fable.Browser.Dom" Version="2.14.0" />
  </ItemGroup>
</Project>
```

**파일 순서 주의:** `<Compile Include>` 순서는 F# 컴파일 순서입니다.
App.fs가 Main.fs보다 먼저 와야 합니다 (Main.fs가 App 모듈을 참조).

### App.fs - MVU 패턴 구현

```fsharp
module App

open Feliz
open Elmish

// Model: 앱의 상태
type Model = { Message: string }

// Msg: 발생 가능한 이벤트
type Msg = NoOp

// init: 초기 상태 생성
let init () = { Message = "Hello CalTwo" }, Cmd.none

// update: 이벤트 처리 → 새로운 상태 반환
let update msg model =
    match msg with
    | NoOp -> model, Cmd.none

// view: 상태 → HTML 렌더링
let view model dispatch =
    Html.div [
        prop.style [ style.padding 20; style.fontFamily "sans-serif" ]
        prop.children [
            Html.h1 model.Message
            Html.p "F# + Elmish + Vite + HMR is working!"
        ]
    ]
```

**MVU 패턴이란?**
- **Model**: 앱의 모든 상태를 담는 불변 데이터
- **Update**: Msg를 받아 새로운 Model 반환 (순수 함수)
- **View**: Model을 받아 HTML 생성

### Main.fs - 프로그램 진입점

```fsharp
module Main

open Elmish
open Elmish.React
open Elmish.HMR  // 반드시 마지막!

Program.mkProgram App.init App.update App.view
|> Program.withReactSynchronous "elmish-app"
|> Program.run
```

**중요:** `open Elmish.HMR`은 반드시 마지막에 선언해야 합니다.
HMR이 `Program.run`을 shadowing하여 상태 보존 기능을 추가합니다.

## 3단계: Vite 설정

### vite.config.js - Fable 플러그인 설정

```javascript
import { defineConfig } from "vite";
import fable from "vite-plugin-fable";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [
    fable({ jsx: "automatic" }),  // F# → JS 변환
    react({ include: /\.(fs|js|jsx|ts|tsx)$/ })  // JSX 변환
  ],
  build: {
    sourcemap: true  // 프로덕션 소스맵 활성화
  }
});
```

**플러그인 순서 중요:** `fable()`이 `react()`보다 먼저 와야 합니다.
Fable이 F#을 먼저 JS로 변환한 후, React 플러그인이 JSX를 처리합니다.

### index.html - HTML 진입점

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CalTwo</title>
</head>
<body>
  <div id="elmish-app"></div>
  <script type="module">
    import "/src/Main.fs";
  </script>
</body>
</html>
```

**중요:** `<script type="module">` 안에 `import` 문을 사용합니다.
`src="/src/Main.fs"` 속성 방식은 Vite가 인식하지 못합니다.

## 4단계: 의존성 설치 및 실행

### npm 패키지 설치

```bash
npm install
```

React, Vite, vite-plugin-fable 등이 설치됩니다.

### .NET 패키지 복원

```bash
dotnet restore src/App.fsproj
```

Fable.Core, Feliz, Elmish 패키지들이 복원됩니다.

### 개발 서버 실행

```bash
npm run dev
```

브라우저에서 http://localhost:5173/ 접속 시 "Hello CalTwo"가 보여야 합니다.

## 5단계: HMR(Hot Module Replacement) 확인

### HMR이란?

코드를 수정하면 브라우저를 새로고침하지 않고도 변경사항이 반영됩니다.
Elmish.HMR 덕분에 앱의 **상태도 유지**됩니다.

### 테스트 방법

1. 개발 서버 실행 중 상태에서 `src/App.fs` 열기
2. `Message = "Hello CalTwo"` → `Message = "HMR 동작 확인!"` 수정
3. 저장
4. 브라우저가 자동으로 업데이트되는지 확인 (새로고침 없이)

## 6단계: 소스맵(Source Maps) 확인

### 소스맵이란?

브라우저는 JavaScript를 실행하지만, 개발자 도구에서는 원본 F# 코드를 볼 수 있습니다.
디버깅이 훨씬 쉬워집니다.

### 확인 방법

1. 브라우저 개발자 도구 열기 (F12)
2. Sources 탭 이동
3. 파일 트리에서 `src/App.fs` 확인
4. F# 원본 코드가 보이면 성공

## 핵심 개념 정리

### Fable
F# 코드를 JavaScript로 컴파일하는 도구입니다.
`vite-plugin-fable`이 Vite 개발 서버에 통합되어 자동으로 동작합니다.

### Elmish
Elm Architecture(MVU 패턴)를 F#로 구현한 라이브러리입니다.
- 단방향 데이터 흐름
- 불변 상태 관리
- 순수 함수 기반 업데이트

### Feliz
F#에서 React 컴포넌트를 작성할 수 있게 해주는 타입 안전 DSL입니다.
`Html.div`, `prop.children` 등의 함수로 HTML을 생성합니다.

### HMR (Hot Module Replacement)
코드 수정 시 브라우저 새로고침 없이 변경사항을 반영합니다.
`Elmish.HMR`은 앱 상태까지 보존해줍니다.

## 자주 발생하는 문제

### 1. 개발 서버가 시작되지 않음

**증상:** `npm run dev` 실행 시 에러

**해결:**
- 포트 5173이 사용 중인지 확인: `lsof -i :5173`
- `node_modules/` 삭제 후 재설치: `rm -rf node_modules && npm install`
- `.vite/` 캐시 삭제: `rm -rf .vite`

### 2. "Hello CalTwo"가 보이지 않음

**증상:** 브라우저에 빈 화면

**해결:**
- 브라우저 콘솔 확인 (F12 → Console)
- `open Elmish.HMR`이 Main.fs 마지막에 있는지 확인
- React 버전이 18.3.1인지 확인: `cat package.json | grep react`

### 3. F# 파일 변경이 반영되지 않음

**증상:** 코드 수정 후에도 브라우저 변화 없음

**해결:**
- 개발 서버 재시작: Ctrl+C 후 `npm run dev`
- 브라우저 하드 리프레시: Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)
- Vite 캐시 삭제: `rm -rf .vite`

### 4. 소스맵이 보이지 않음

**증상:** 개발자 도구에 F# 파일 없음

**해결:**
- `vite.config.js`에 `build: { sourcemap: true }` 있는지 확인
- 브라우저 설정: DevTools → Settings → Enable JavaScript source maps 체크

## 다음 단계

Phase 2에서는 계산기의 핵심 로직을 구현합니다:
- 숫자 입력 처리
- 사칙연산 계산
- 에러 처리 (divide by zero)
- 단위 테스트 작성

현재까지 구축한 환경에서 MVU 패턴으로 계산기 상태를 관리하게 됩니다.

## 참고 자료

- [Fable 공식 문서](https://fable.io/)
- [Elmish 가이드](https://elmish.github.io/elmish/)
- [Feliz 문서](https://zaid-ajaj.github.io/Feliz/)
- [vite-plugin-fable](https://github.com/fable-compiler/vite-plugin-fable)
```

This tutorial satisfies:
- TUT-01: Korean markdown in tutorial/ directory
- TUT-02: Step-by-step explanation for beginners (각 단계 상세 설명)
- TUT-03: Code examples, commands, explanations (모든 파일 내용 + 실행 명령)

Additional sections:
- 핵심 개념 정리: MVU, Fable, Feliz, HMR 개념 설명
- 자주 발생하는 문제: 트러블슈팅 가이드
- 다음 단계: Phase 2 preview
  </action>
  <verify>
File exists and meets requirements:
- test -f tutorial/phase-01.md
- wc -l tutorial/phase-01.md | grep -E '[0-9]{3}'  # Should be 100+ lines
- grep "MVU 패턴" tutorial/phase-01.md
- grep "npm run dev" tutorial/phase-01.md
  </verify>
  <done>
tutorial/phase-01.md exists with 100+ lines, explains MVU pattern in Korean, includes all code examples and commands, provides troubleshooting guide
  </done>
</task>

</tasks>

<verification>
After this plan:
1. npm packages installed (node_modules/ exists with vite-plugin-fable)
2. .NET packages restored (src/obj/project.assets.json exists)
3. Dev server starts without errors
4. curl http://localhost:5173/ returns 200 OK
5. HTML contains div#elmish-app
6. Korean tutorial created with 100+ lines, all code examples, troubleshooting guide
</verification>

<success_criteria>
1. npm install completes without version conflicts
2. dotnet restore completes without missing package errors
3. npm run dev starts Vite server successfully
4. HTTP GET localhost:5173 returns 200 OK
5. HTML response contains <div id="elmish-app">
6. Fable transpiles F# files without compilation errors
7. tutorial/phase-01.md exists with comprehensive Korean content
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-tooling/01-02-SUMMARY.md`
</output>
